<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>ExamSpeed Math</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        :root { --bg: #0f172a; --card: #1e293b; --primary: #38bdf8; --gold: #fbbf24; --success: #22c55e; --danger: #ef4444; }
        * { box-sizing: border-box; font-family: 'Outfit', sans-serif; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: white; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        
        .header { padding: 15px; background: rgba(30, 41, 59, 0.95); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #334155; }
        .app-name { font-size: 18px; font-weight: 900; }

        /* NOTICE BOARD STYLE */
        #notice-box { background: var(--gold); color: black; font-weight: 800; padding: 8px 0; font-size: 13px; display: none; }
        
        .main-container { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
        .card { background: var(--card); border-radius: 12px; padding: 15px; border: 1px solid #334155; text-align: center; margin-bottom: 10px; cursor: pointer; }
        .card:active { transform: scale(0.98); background: #283548; }
        
        .live-btn { background: linear-gradient(135deg, #ef4444, #b91c1c); color: white; border: none; width: 100%; padding: 20px; border-radius: 12px; text-align: left; margin-bottom: 15px; cursor: pointer; }
        
        /* Overlays */
        .overlay { position: fixed; inset: 0; background: var(--bg); z-index: 200; display: none; flex-direction: column; padding: 20px; }
        .opt-btn { width: 100%; padding: 15px; background: var(--card); border: 1px solid #334155; margin-bottom: 8px; color: white; border-radius: 8px; font-size: 16px; text-align: left; }
    </style>
</head>
<body>

    <div class="header">
        <span class="app-name">ExamSpeed <span style="color:var(--primary); font-size:10px;">PRO</span></span>
        <button onclick="window.open('https://whatsapp.com/channel/0029VbCeXOeDp2QApxl6vi2p')" style="background:#25d366; border:none; color:white; padding:5px 10px; border-radius:5px; font-weight:bold; font-size:10px;">JOIN WA</button>
    </div>

    <div id="notice-box">
        <marquee behavior="scroll" direction="left" id="notice-text">Loading Notice...</marquee>
    </div>

    <div class="main-container">
        <button class="live-btn" onclick="startLive()">
            <h2 style="margin:0;">üî• Daily Challenge</h2>
            <small>Live Questions from Admin</small>
        </button>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div class="card" onclick="startMath('Addition')">‚ûï Add</div>
            <div class="card" onclick="startMath('Subtraction')">‚ûñ Subtract</div>
            <div class="card" onclick="startMath('Multiplication')">‚úñÔ∏è Multiply</div>
            <div class="card" onclick="startMath('Division')">‚ûó Divide</div>
            <div class="card" onclick="startMath('Squares Test')">x¬≤ Squares</div>
            <div class="card" onclick="startMath('Mix Speed Test')">‚ö° Mix Test</div>
        </div>
    </div>

    <div id="quiz-overlay" class="overlay">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h2 id="q-title">Quiz</h2>
            <button onclick="closeQuiz()" style="background:none; border:none; color:white; font-size:20px;">‚úï</button>
        </div>
        <div id="quiz-box" style="text-align:center; margin-top:50px;">
            <h1 id="q-disp" style="font-size:30px; margin-bottom:30px;">Loading...</h1>
            <div id="opt-area"></div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAv5aEJ1rBFRM1qV7GqxbDYG2OIVzzIJDE",
            authDomain: "examspeed-math-9f575.firebaseapp.com",
            projectId: "examspeed-math-9f575",
            storageBucket: "examspeed-math-9f575.firebasestorage.app",
            messagingSenderId: "318204688428",
            appId: "1:318204688428:web:c7d6040c49d9ff30fbf989"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // 1. NOTICE BOARD LOGIC (Real-time)
        db.collection('config').doc('notice').onSnapshot(doc => {
            const box = document.getElementById('notice-box');
            if(doc.exists && doc.data().text && doc.data().text !== "") {
                box.style.display = 'block';
                document.getElementById('notice-text').innerText = "üì¢ " + doc.data().text;
            } else {
                box.style.display = 'none';
            }
        });

        // 2. QUIZ LOGIC
        let questions = [], qIdx = 0, score = 0;
        
        function startLive() {
            db.collection("challenges").orderBy("timestamp", "desc").limit(20).get().then(snap => {
                if(snap.empty) return alert("No Live Questions Today!");
                questions = [];
                snap.forEach(d => questions.push(d.data()));
                runQuiz("Daily Challenge");
            });
        }

        function startMath(mode) {
            questions = [];
            for(let i=0; i<10; i++) {
                let n1 = Math.floor(Math.random()*20)+2, n2 = Math.floor(Math.random()*10)+2;
                let q, a;
                if(mode=='Addition'){ q=`${n1} + ${n2}`; a=n1+n2; }
                else if(mode=='Multiplication'){ q=`${n1} √ó ${n2}`; a=n1*n2; }
                else { q=`${n1} - ${n2}`; a=n1-n2; }
                
                let opts = [a, a+1, a-1, a+2].sort(()=>Math.random()-0.5);
                questions.push({q:q, correct:a, options:opts});
            }
            runQuiz(mode);
        }

        function runQuiz(title) {
            document.getElementById('q-title').innerText = title;
            document.getElementById('quiz-overlay').style.display = 'flex';
            qIdx = 0; score = 0;
            showQ();
        }

        function showQ() {
            if(qIdx >= questions.length) { alert("Game Over! Score: " + score); closeQuiz(); return; }
            let curr = questions[qIdx];
            document.getElementById('q-disp').innerText = curr.q;
            let h = '';
            curr.options.forEach(o => h += `<button class="opt-btn" onclick="check('${o}', '${curr.correct}')">${o}</button>`);
            document.getElementById('opt-area').innerHTML = h;
        }

        function check(sel, cor) {
            if(sel == cor) score++;
            qIdx++;
            showQ();
        }
        function closeQuiz() { document.getElementById('quiz-overlay').style.display = 'none'; }
    </script>
</body>
</html>
